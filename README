This is a "plugin" for the Video Disk Recorder (VDR).

Project's homepage:          https://github.com/FireFlyVDR/vdr-plugin-xmltv4vdr
Latest version available at: https://github.com/FireFlyVDR/vdr-plugin-xmltv4vdr/files

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.
See the file COPYING for more information.


Description:
------------
This plugin for the Linux Video Disk Recorder VDR imports EPG data from
external sources in XMLTV format and enhances the DVB EPG with that including
links to pictures. The file(s) in XMLTV format must be provided by one (or
more) additional grabber which are not part of this plugin.
The elements to be imported can be configured selectivly by channel and type of
event (movies, series or all).
Additionally the episode info from eplists.constabel.net is optionally
integrated.

Please be aware that depending on the EPG data quality not in every situation
a match for a DVB event can be found in the external events.

Requirements:
-------------
VDR 2.4.5+
libsqlite3
libxml2

Installation and Configuration:
-------------------------------
- compile plugin (or install from your distribution) as usual
- configure the locations of several files in <VDR-config-path>/conf.d/50-xmltv4vdr.conf
- choose at least one EPG grabber and execute for each grabber:
  - get the additional grabber executable from its source location
  - put the executable and the configuration file in /var/lib/epgsources
  - start VDR and go to the plugin settings of xmltv4vdr
  - for each EPG source enable it in the sub-menu and set parameters as required
  - for each provided channel of the EPG source you want to import into VDR enter the sub-menu and:
      1. choose a source
      2. select all VDR channels to map to
      3. select the flags which info should be available to VDR
      for convenience the flags can be copied with the blue button (or deleted with the
      yellow button) to all other configured source channels


Episode Lists
-------------
The plugin supports optionally the episode lists of eplists.constabel.net.
It reads a local directory with episode files into a SQLite DB
for faster queries before each update of external sources.
UTF-8 format is mendatory for the episode files.

To enable episode lists download the files regularly into an episode directory
via cron, e.g.:
   05 01 * * * vdr /usr/bin/svdrpsend-ng.pl -d eplists.constabel.net -p 2006 -c -o /srv/vdr/episodes TGET newer than $(($(date '+\%s')-$(stat -c %Y \"$(ls -t1 /srv/vdr/episodes/*|head -n 1)\")+3600)) seconds >/var/log/eplists 2>&1
and define in xmltv4xml.conf the location of the local episode DB (--episodesdb=DIR)
If the path of the episode diretory should be different from the default
<Plugin-ResourceDir>/episodes you can define it with the --episodes parameter.

The series and episode info is also written in XML format into the AUX field of the events. It
can be read by any other plugin. or e.g. svdrpsend LSTE <channel No> at <timestamp> :
#> svdrpsend LSTE 1 at 1721585700
.....
215-@ <xmltv4vdr><season>53</season><episode>16</episode><episodeOverall>1199</episodeOverall></xmltv4vdr>
....


Config files
============
/etc/vdr/conf.d/50-xmltv4vdr.conf
---------------------------------
contains all parameters the plugin supports:
[xmltv4vdr]
#  -d FILE,  --epgdatabase=FILE   write the EPG database into the given FILE
#                                 default: <Plugin-CacheDir>/xmltv4vdr_EPG.db

#  -i DIR,   --images=DIR         location where EPG images are stored
#                                 default: <Plugin-CacheDir>/epgimages

#  -s DIR,   --epgsources=DIR     location where EPG Sources are stored
#                                 default: /var/lib/epgsources

#  -e DIR,   --episodes=DIR       location of episode files (UTF-8 format only!)
#                                 default is <Plugin-ResourceDir>/episodes

#  -E DIR,   --episodesdb=DIR     read the Episodes DB from the given SQLite FILE
#                                 default: none

#  -l FILE,  --logfile=FILE       write trace logs into the given FILE
#                                 default: no trace log written

/etc/vdr/plugins/xmltv4vdr/xmltv4vdr.conf
-----------------------------------------
contains general settings, channel mappings with flags and source specific settings
It can be modified with the plugins setup menu and is not intended to be edited.

/var/lib/epgsources/*
---------------------
for each EPG source:
   - a folder for EPG images (if any) named <epg-source>-img
   - for xmltv files provided via file interface the xmltv file named <epg-source>.xmltv
   - a configuation file named <epg-source> with the following structure:
     line 1:  mode;00:00;P;I
         where mode is file or pipe
               00:00 start time (unused)
               P  1=pin required, else 0
               I  1=provides pictures, else 0
     line 2:  number of days EPG is provided by source
     line 3 to end:  names of provided channels

Example:
file;00:00;0;1
7
ard.de
ard-alpha.de
zdf.de
zdfinfo.de
zdfneo.de

